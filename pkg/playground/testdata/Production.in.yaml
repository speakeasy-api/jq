type: object
x-speakeasy-transform-from-api:
  jq: |
    (
      . as $in
      | ($in.source_kafka_cluster // null) as $src
      | ($in.destination_kafka_cluster // null) as $dest
      | ($in.local_kafka_cluster // null) as $local
      | ($in.remote_kafka_cluster // null) as $remote
      | (if $src then $src elif $dest then $dest elif $remote then $remote else null end) as $remoteBlock
      | (if $remoteBlock then ($remoteBlock.bootstrap_endpoint // $remoteBlock.rest_endpoint // null) else null end) as $ep
      | (
          if $ep == null then null
          elif ($ep | test("://")) then ($ep | split("://")[1] | split("/")[0] | sub(":443$"; ":9092") | if test(":\\d+$") then . else . + ":9092" end)
          else ($ep | split("/")[0] | sub(":443$"; ":9092") | if test(":\\d+$") then . else . + ":9092" end)
          end
        ) as $bootstrap
      | ($in.config // {}) as $usercfg
      | (
          if $in.link_mode then $in.link_mode
          elif ($local and $remote) then "BIDIRECTIONAL"
          elif $src then "DESTINATION"
          elif $dest then "SOURCE"
          else null
          end
        ) as $lm
      | (if $in.connection_mode then $in.connection_mode else "OUTBOUND" end) as $cm
      | (
          (
            ($usercfg | to_entries | map({name: .key, value: (.value | tostring)}))
            + (if $bootstrap then [{name: "bootstrap.servers", value: $bootstrap}] else [] end)
            + (
                if $remoteBlock.credentials then
                  [
                    {name: "sasl.mechanism", value: "PLAIN"},
                    {name: "security.protocol", value: "SASL_SSL"},
                    {name: "sasl.jaas.config", value: ("org.apache.kafka.common.security.plain.PlainLoginModule required username='" + ($remoteBlock.credentials.key // "") + "' password='" + ($remoteBlock.credentials.secret // "") + "';")}
                  ]
                else []
                end
              )
            + (
                if $local.credentials then
                  [
                    {name: "local.sasl.mechanism", value: "PLAIN"},
                    {name: "local.security.protocol", value: "SASL_SSL"},
                    {name: "local.sasl.jaas.config", value: ("org.apache.kafka.common.security.plain.PlainLoginModule required username='" + ($local.credentials.key // "") + "' password='" + ($local.credentials.secret // "") + "';")}
                  ]
                else []
                end
              )
            + (if $lm then [{name: "link.mode", value: $lm}] else [] end)
            + (if $cm then [{name: "connection.mode", value: $cm}] else [] end)
          ) | reduce .[] as $c ({}; .[$c.name] = $c.value)
            | to_entries
            | sort_by(.key)
            | map({name: .key, value: .value})
        ) as $configs
      | (
          {}
          | if $src then . + {source_cluster_id: $src.id} else . end
          | if $dest then . + {destination_cluster_id: $dest.id} else . end
          | if ($local and $remote) then . + {remote_cluster_id: $remote.id} else . end
          | . + {configs: $configs}
        )
    )
description: "`Clusters` objects represent Apache Kafka Clusters on Confluent Cloud.\n\nThe API allows you to list, create, read, update, and delete your Kafka clusters.\n\n\nRelated guide: [Confluent Cloud Cluster Management for Apache Kafka APIs](https://docs.confluent.io/cloud/current/clusters/cluster-api.html).\n\n## The Clusters Model\n<SchemaDefinition schemaRef=\"#/components/schemas/cmk.v2.Cluster\" />\n\n## Quotas and Limits\nThis resource is subject to the [following quotas](https://docs.confluent.io/cloud/current/quotas/overview.html):\n\n| Quota | Description |\n| --- | --- |\n| `kafka_clusters_per_environment` | Number of clusters in one Confluent Cloud environment |"
properties:
api_version:
  type: string
  enum:
    - cmk/v2
  description: APIVersion defines the schema version of this representation of a resource.
  readOnly: true
kind:
  type: string
  description: Kind defines the object this REST resource represents.
  readOnly: true
  enum:
    - Cluster
id:
  description: ID is the "natural identifier" for an object within its scope/namespace; it is normally unique across time but not space. That is, you can assume that the ID will not be reclaimed and reused after an object is deleted ("time"); however, it may collide with IDs for other object `kinds` or objects of the same `kind` within a different scope/namespace ("space").
  type: string
  maxLength: 255
  readOnly: true
  example: dlz-f3a90de
metadata:
  allOf:
    - description: ObjectMeta is metadata that all persisted resources must have, which includes all objects users must create.
      required:
        - self
      properties:
        self:
          description: Self is a Uniform Resource Locator (URL) at which an object can be addressed. This URL encodes the service location, API version, and other particulars necessary to locate the resource at a point in time
          type: string
          format: uri
          readOnly: true
          example: https://api.confluent.cloud/v2/kafka-clusters/lkc-f3a90de
        resource_name:
          description: Resource Name is a Uniform Resource Identifier (URI) that is globally unique across space and time. It is represented as a Confluent Resource Name
          type: string
          format: uri
          readOnly: true
          example: crn://confluent.cloud/kafka=lkc-f3a90de
        created_at:
          type: string
          format: date-time
          example: "2006-01-02T15:04:05-07:00"
          readOnly: true
          description: The date and time at which this object was created. It is represented in RFC3339 format and is in UTC.
        updated_at:
          type: string
          format: date-time
          example: "2006-01-02T15:04:05-07:00"
          readOnly: true
          description: The date and time at which this object was last updated. It is represented in RFC3339 format and is in UTC.
        deleted_at:
          type: string
          format: date-time
          example: "2006-01-02T15:04:05-07:00"
          readOnly: true
          description: The date and time at which this object was (or will be) deleted. It is represented in RFC3339 format and is in UTC.
      readOnly: true
    - properties:
        self:
          example: https://api.confluent.cloud/cmk/v2/clusters/lkc-12345
        resource_name:
          example: crn://confluent.cloud/organization=9bb441c4-edef-46ac-8a41-c49e44a3fd9a/environment=env-abc123/cloud-cluster=lkc-12345
spec:
  type: object
  description: The desired state of the Cluster
  properties:
    display_name:
      type: string
      description: The name of the cluster.
      example: ProdKafkaCluster
    availability:
      type: string
      description: |
        The availability zone configuration of the cluster
      x-extensible-enum:
        - MULTI_ZONE
        - SINGLE_ZONE
        - HIGH
        - LOW
      example: SINGLE_ZONE
    cloud:
      type: string
      description: The cloud service provider in which the cluster is running.
      x-extensible-enum:
        - AWS
        - GCP
        - AZURE
      example: GCP
      x-immutable: true
    region:
      type: string
      description: The cloud service provider region where the cluster is running.
      example: us-east4
      x-immutable: true
    config:
      description: |
        The configuration of the Kafka cluster.

        Note: Clusters can be upgraded from Basic to Standard, but cannot be downgraded from Standard to Basic.
      default:
        kind: Basic
      example:
        kind: Basic
      oneOf:
        - type: object
          description: |
            The basic cluster type.
          properties:
            kind:
              description: |
                Basic cluster type.
              type: string
              enum:
                - Basic
          required:
            - kind
        - type: object
          description: |
            The standard cluster type.
          properties:
            kind:
              description: |
                Standard cluster type.
              type: string
              enum:
                - Standard
          required:
            - kind
        - type: object
          description: |
            A dedicated cluster with its parameters.
          properties:
            kind:
              type: string
              enum:
                - Dedicated
              description: |
                Dedicated cluster type.
            cku:
              description: |
                The number of Confluent Kafka Units (CKUs) for Dedicated cluster types.
                MULTI_ZONE dedicated clusters must have at least two CKUs.
              type: integer
              format: int32
              minimum: 1
              example: 2
            encryption_key:
              type: string
              description: |
                The id of the encryption key that is used to encrypt the data in the Kafka cluster.
                (e.g. for Amazon Web Services, the Amazon Resource Name of the key).
              example: arn:aws:kms:us-west-2:000000000000:key/0000xxxx-00xx-00xx-00xx-0000000000xx
              deprecated: true
              x-immutable: true
            zones:
              type: array
              items:
                type: string
              uniqueItems: true
              minItems: 1
              maxItems: 3
              description: |
                The list of zones the cluster is in.

                On AWS, zones are AWS [AZ IDs](https://docs.aws.amazon.com/ram/latest/userguide/working-with-az-ids.html)
                 (e.g. use1-az3)

                On GCP, zones are GCP [zones](https://cloud.google.com/compute/docs/regions-zones)
                 (e.g. us-central1-c).
              readOnly: false
              example:
                - us-central1-a
                - us-central1-b
                - us-central1-c
              x-immutable: true
          required:
            - kind
            - cku
        - type: object
          description: |
            The enterprise cluster type.
          properties:
            kind:
              description: |
                Enterprise cluster type.
              type: string
              enum:
                - Enterprise
          required:
            - kind
        - type: object
          description: |
            A freight cluster with its parameters.
          properties:
            kind:
              type: string
              enum:
                - Freight
              description: |
                Freight cluster type.
            zones:
              type: array
              items:
                type: string
              uniqueItems: true
              minItems: 1
              maxItems: 3
              description: |
                The list of zones the cluster is in.

                On AWS, zones are AWS [AZ IDs](https://docs.aws.amazon.com/ram/latest/userguide/working-with-az-ids.html)
                 (e.g. use1-az3)

                On GCP, zones are GCP [zones](https://cloud.google.com/compute/docs/regions-zones)
                 (e.g. us-central1-c).
              readOnly: true
              example:
                - us-central1-a
                - us-central1-b
                - us-central1-c
              x-immutable: true
          required:
            - kind
    kafka_bootstrap_endpoint:
      type: string
      description: The bootstrap endpoint used by Kafka clients to connect to the cluster.
      example: lkc-00000-00000.us-central1.gcp.glb.confluent.cloud:9092
      x-immutable: true
      readOnly: true
    http_endpoint:
      type: string
      description: The cluster HTTP request URL.
      format: uri
      example: https://lkc-00000-00000.us-central1.gcp.glb.confluent.cloud
      x-immutable: true
      readOnly: true
    api_endpoint:
      type: string
      description: The Kafka API cluster endpoint used by Kafka clients to connect to the cluster.
      example: https://pkac-00000.us-west-2.aws.confluent.cloud
      x-immutable: true
      readOnly: true
    endpoints:
      description: |
        A map of endpoints for connecting to the Kafka cluster,
        keyed by access_point_id. Access Point ID 'PUBLIC' and 'PRIVATE_LINK' are reserved.
        These can be used for different network access methods or regions.
      example:
        ap1pni123:
          kafka_bootstrap_endpoint: lkc-s1232-00000.us-central1.gcp.private.confluent.cloud:9092
          http_endpoint: https://lkc-s1232.us-central1.gcp.private.confluent.cloud:443
          connection_type: PRIVATENETWORKINTERFACE
        ap2platt67890:
          kafka_bootstrap_endpoint: lkc-00000-00000.us-central1.gcp.glb.confluent.cloud:9092
          http_endpoint: https://lkc-00000-00000.us-central1.gcp.glb.confluent.cloud
          connection_type: PRIVATELINK
      allOf:
        - type: object
          description: |
            Map of endpoints for a Kafka cluster, keyed by access point ID.
          additionalProperties:
            type: object
            description: |
              Given a gateway type, endpoints to connect to the Kafka cluster.
            properties:
              kafka_bootstrap_endpoint:
                type: string
                description: |
                  The bootstrap endpoint used by Kafka clients to connect to the cluster.
                example: lkc-00000-00000.us-central1.gcp.glb.confluent.cloud:9092
              http_endpoint:
                type: string
                description: |
                  The REST endpoint for the Kafka cluster.
                format: uri
                example: https://lkc-00000-00000.us-central1.gcp.glb.confluent.cloud:443
              connection_type:
                type: string
                description: |
                  The type of connection used for the endpoint.
                x-extensible-enum:
                  - PUBLIC
                  - PRIVATE_LINK
                  - PRIVATE_NETWORK_INTERFACE
                example: PRIVATE_NETWORK_INTERFACE
            required:
              - kafka_bootstrap_endpoint
              - http_endpoint
              - connection_type
            readOnly: true
          readOnly: true
          example:
            ap1pni123:
              kafka_bootstrap_endpoint: lkc-s1232-00000.us-central1.gcp.private.confluent.cloud:9092
              http_endpoint: https://lkc-s1232.us-central1.gcp.private.confluent.cloud:443
              connection_type: PRIVATE_NETWORK_INTERFACE
            ap2platt67890:
              kafka_bootstrap_endpoint: lkc-00000-00000.us-central1.gcp.glb.confluent.cloud:9092
              http_endpoint: https://lkc-00000-00000.us-central1.gcp.glb.confluent.cloud
              connection_type: PRIVATE_LINK
      readOnly: true
    environment:
      allOf:
        - type: object
          description: ObjectReference provides information for you to locate the referred object
          required:
            - id
            - related
            - resource_name
          properties:
            id:
              type: string
              description: ID of the referred resource
              minLength: 1
              maxLength: 255
            environment:
              type: string
              description: Environment of the referred resource, if env-scoped
              minLength: 1
              maxLength: 255
            related:
              type: string
              format: uri
              description: API URL for accessing or modifying the referred object
              minLength: 1
              readOnly: true
            resource_name:
              type: string
              format: uri
              description: CRN reference to the referred resource
              minLength: 1
              readOnly: true
      description: The environment to which this belongs.
    network:
      allOf:
        - type: object
          description: ObjectReference provides information for you to locate the referred object
          required:
            - id
            - related
            - resource_name
          properties:
            id:
              type: string
              description: ID of the referred resource
              minLength: 1
              maxLength: 255
            environment:
              type: string
              description: Environment of the referred resource, if env-scoped
              minLength: 1
              maxLength: 255
            related:
              type: string
              format: uri
              description: API URL for accessing or modifying the referred object
              minLength: 1
              readOnly: true
            resource_name:
              type: string
              format: uri
              description: CRN reference to the referred resource
              minLength: 1
              readOnly: true
      description: The network associated with this object.
      x-immutable: true
    byok:
      allOf:
        - type: object
          description: ObjectReference provides information for you to locate the referred object
          required:
            - id
            - related
            - resource_name
          properties:
            id:
              type: string
              description: ID of the referred resource
              minLength: 1
              maxLength: 255
            related:
              type: string
              format: uri
              description: API URL for accessing or modifying the referred object
              minLength: 1
              readOnly: true
            resource_name:
              type: string
              format: uri
              description: CRN reference to the referred resource
              minLength: 1
              readOnly: true
      description: |
        Note: For Pre-BYOK v1 clusters, API responses might show both
        `encryption_key` and `byok`.
        To manage Pre-BYOK v1 keys, refer to:
        https://docs.confluent.io/cloud/current/security/encrypt/byok/legacy-byok.html
        #manage-pre-byok-api-v1-self-managed-encryption-keys
      x-immutable: true
  x-enable-id: true
  x-enable-listmeta: true
  x-enable-objectmeta: true
status:
  type: object
  required:
    - phase
  description: The status of the Cluster
  properties:
    phase:
      type: string
      x-extensible-enum:
        - PROVISIONING
        - PROVISIONED
        - FAILED
      description: |
        The lifecyle phase of the cluster:
          PROVISIONED:  cluster is provisioned;
          PROVISIONING:  cluster provisioning is in progress;
          FAILED:  provisioning failed
      readOnly: true
      example: PROVISIONED
    cku:
      description: |
        The number of Confluent Kafka Units (CKUs) the Dedicated cluster currently has.
      readOnly: true
      type: integer
      format: int32
      minimum: 1
      example: 2
  readOnly: true
